<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css" rel="stylesheet">
  <title>Getnerate-Effective-Desktop</title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }
    input {
      text-align: center;
    }
  .checkbox {
    width: 20px;
    height: 20px;
    background-color: #fff;
    text-align: center
  }
  .checkbox-selected {
    background: url('./select.png');
    background-color: #fff;
  }
  .generate:hover {
    cursor: pointer;
  }
  .four-table {
    display: flex;
    flex-wrap: wrap;
  }
  .table-content {
    width: 50%;
    border: 1px solid #fff;
    padding: 10px 20px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  .table-content input {
    width: 100%;
    margin: 10px 0
  }
  .four-row {
    display: flex;
    flex-wrap: wrap;
  }
  .row-content {
    width: 100%;
    border: 1px solid #fff;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    justify-content: space-around
  }
  .row-content input {
    width: 40%;
  }
  .four-column {
    display: flex;
  }
  .column-content {
    width: 25%;
    padding: 20px 10px;
    border: 1px solid #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-around;
  }
  .column-content input {
    width: 100%;
  }
  .column {
    min-width: 360px;
    max-width: 360px;
  }
  .message-body {
    min-height: 280px;
    max-height: 280px;
  }
  .table-desktop {
    position: absolute;
    top: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-wrap: wrap;
    z-index: 99;
  }
  .row-desktop {
    position: absolute;
    top: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    z-index: 99;
  }
  .column-desktop {
    position: absolute;
    top: 0;
    width: 100%;
    height: 100%;
    display: flex;
    z-index: 99;
  }
  .download {
    z-index: -99;
  }
  </style>
</head>

<body>
  <section class="hero is-info">
    <div class="hero-body">
      <div class="container">
        <h1 style="text-align: center;font-size: 30px">可配置生成效率桌面</h1>
        <p style="text-align:center;color: orange;font-weight: bold">[温馨提示]:为保证效果，请将浏览器窗口调整至最大化～</p>
      </div>
    </div>
  </section>
  <div class="box cta">
    <div class="columns is-mobile is-centered" style="padding: 10px 0">
      <div class="field is-grouped is-grouped-multiline">
        <div class="control">
          <a onclick="previewDesktop()" class="button is-success">生成预览</a>
          <a onclick="generateDesktop()" class="button is-danger">点击下载</a>
        </div>
      </div>
    </div>
  </div>
  <section class="container">
    <div class="columns is-mobile is-centered" id="sectioncontainer">
      <div class="column is-narrow">
        <article class="message is-info">
          <div class="message-header">
            <p>四格型</p>
            <span name='table' onclick="changeSelectType('table')" class="checkbox checkbox-selected"></span>
          </div>
          <div class="message-body four-table" style="background-color: #209cee;opacity: 0.6;">
            <div class="table-content table-content-1">
              <input type='text' value='应用' onblur='inputTextChange(this, "table", 1)' />
              <input type="color" value='#ffc0cb' onchange='inputColorChange(this, "table", 1)' style="width:50%" />
            </div>
            <div class="table-content table-content-2">
              <input type='text' value='文档' onchange='inputTextChange(this, "table", 2)' />
              <input type="color" value='#00bfff' onchange='inputColorChange(this, "table", 2)' style="width:50%" />
            </div>
            <div class="table-content table-content-3">
              <input type='text' value='已完成' onchange='inputTextChange(this, "table", 3)' />
              <input type="color" value='#40e0d0' onchange='inputColorChange(this, "table", 3)' style="width:50%" />
            </div>
            <div class="table-content table-content-4">
              <input type='text' value='未完成' onchange='inputTextChange(this, "table", 4)' />
              <input type="color" value='#ffdd57' onchange='inputColorChange(this, "table", 4)' style="width:50%" />
            </div>
          </div>
        </article>
      </div>
      <div class="column is-narrow">
        <article class="message is-warning">
          <div class="message-header">
            <p style="color:#fff">四行型</p>
            <span name='row' onclick="changeSelectType('row')" class="checkbox"></span>
          </div>
          <div class="message-body four-row" style="background-color: #ffdd57;opacity: 0.6;">
            <div class="row-content row-content-1">
              <input type='text' value='应用' onblur='inputTextChange(this, "row", 1)' />
              <input type="color" value='#ffc0cb' onchange='inputColorChange(this, "row", 1)' style="width:20%" />
            </div>
            <div class="row-content row-content-2">
              <input type='text' value='文档' onblur='inputTextChange(this, "row", 2)' />
              <input type="color" value='#00bfff' onchange='inputColorChange(this, "row", 2)' style="width:20%" />
            </div>
            <div class="row-content row-content-3">
              <input type='text' value='已完成' onblur='inputTextChange(this, "row", 3)' />
              <input type="color" value='#40e0d0' onchange='inputColorChange(this, "row", 3)' style="width:20%" />
            </div>
            <div class="row-content row-content-4">
              <input type='text' value='未完成' onblur='inputTextChange(this, "row", 4)' />
              <input type="color" value='#ffdd57' onchange='inputColorChange(this, "row", 4)' style="width:20%" />
            </div>
          </div>
        </article>
      </div>
      <div class="column is-narrow">
        <article class="message is-primary">
          <div class="message-header">
            <p>四列型</p>
            <span name='column' onclick="changeSelectType('column')" class="checkbox"></span>
          </div>
          <div class="message-body four-column" style="background-color: #00d1b2;opacity: 0.6;">
            <div class="column-content column-content-1">
              <input type='text' value='应用' onblur='inputTextChange(this, "column", 1)' />
              <input type="color" value='#ffc0cb' onchange='inputColorChange(this, "column", 1)' style="width:80%" />
            </div>
            <div class="column-content column-content-2">
              <input type='text' value='文档' onblur='inputTextChange(this, "column", 2)' />
              <input type="color" value='#00bfff' onchange='inputColorChange(this, "column", 2)' style="width:80%" />
            </div>
            <div class="column-content column-content-3">
              <input type='text' value='已完成' onblur='inputTextChange(this, "column", 3)' />
              <input type="color" value='#40e0d0' onchange='inputColorChange(this, "column", 3)' style="width:80%" />
            </div>
            <div class="column-content column-content-4">
              <input type='text' value='未完成' onblur='inputTextChange(this, "column", 4)' />
              <input type="color" value='#ffdd57' onchange='inputColorChange(this, "column", 4)' style="width:80%" />
            </div>
          </div>
        </article>
      </div>
    </div>
  </section>
  <footer style="position:absolute;width:100%;bottom:0">
    <div class="box cta">
      <div class="columns is-mobile is-centered">
        <div class="field is-grouped is-grouped-multiline">
          <div class="control">
            <div class="tags has-addons">
              <a target="_blank" class="tag is-info" href="https://luffyzh.github.io">
                @author luffyZhou
              </a>
              </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <div id='preview-table' class="table-desktop preview" style="display: none">
    <div class="table-content"></div>
    <div class="table-content"></div>
    <div class="table-content"></div>
    <div class="table-content"></div>
  </div>
  <div id='preview-row' class="row-desktop preview" style="display: none">
    <div class="row-content" style="height:25%"></div>
    <div class="row-content" style="height:25%"></div>
    <div class="row-content" style="height:25%"></div>
    <div class="row-content" style="height:25%"></div>
  </div>
  <div id='preview-column' class="column-desktop preview" style="display: none">
    <div class="column-content"></div>
    <div class="column-content"></div>
    <div class="column-content"></div>
    <div class="column-content"></div>
  </div>
  <div id='download-table' class="table-desktop download">
    <div class="table-content"></div>
    <div class="table-content"></div>
    <div class="table-content"></div>
    <div class="table-content"></div>
  </div>
  <div id='download-row' class="row-desktop download">
    <div class="row-content" style="height:25%"></div>
    <div class="row-content" style="height:25%"></div>
    <div class="row-content" style="height:25%"></div>
    <div class="row-content" style="height:25%"></div>
  </div>
  <div id='download-column' class="column-desktop download">
    <div class="column-content"></div>
    <div class="column-content"></div>
    <div class="column-content"></div>
    <div class="column-content"></div>
  </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/javascript-canvas-to-blob/3.14.0/js/canvas-to-blob.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2014-11-29/FileSaver.min.js"></script>
<script>
  const finalObj = {
    screenWidth: window.screen.width * window.devicePixelRatio,
    screenHeight: window.screen.height * window.devicePixelRatio,
    selectType: 'table',
    tableArr: [
      {
        text: '应用',
        color: '#ffc0cb'
      }, {
        text: '文档',
        color: '#00bfff'
      }, {
        text: '已完成',
        color: '#40e0d0'
      }, {
        text: '未完成',
        color: '#ffdd57'
      }
    ],
    rowArr: [
    {
        text: '应用',
        color: '#ffc0cb'
      }, {
        text: '文档',
        color: '#00bfff'
      }, {
        text: '已完成',
        color: '#40e0d0'
      }, {
        text: '未完成',
        color: '#ffdd57'
      }
    ],
    columnArr: [
    {
        text: '应用',
        color: '#ffc0cb'
      }, {
        text: '文档',
        color: '#00bfff'
      }, {
        text: '已完成',
        color: '#40e0d0'
      }, {
        text: '未完成',
        color: '#ffdd57'
      }
    ]
  }
  // 修改文本的变化
  function inputTextChange(_this, type, index) {
    switch(type) {
      case 'table': {
        finalObj.tableArr[index - 1].text = _this.value;
        break;
      }
      case 'row': {
        finalObj.rowArr[index - 1].text = _this.value;
        break;
      }
      case 'column': {
        finalObj.columnArr[index - 1].text = _this.value;
        break;
      }
      default:
    }
  }
  // 修改颜色值的变化
  function inputColorChange(_this, type, index) {
    switch(type) {
      case 'table': {
        finalObj.tableArr[index - 1].color = _this.value;
        break;
      }
      case 'row': {
        finalObj.rowArr[index - 1].color = _this.value;
        break;
      }
      case 'column': {
        finalObj.columnArr[index - 1].color = _this.value;
        break;
      }
      default:
    }
  }
  // 修改选择的类型
  function changeSelectType(type) {
    finalObj.selectType = type;
    const checkboxElems = Array.from(document.getElementsByClassName('checkbox'));
    checkboxElems.forEach(item => {
      item.className = 'checkbox';
      if (item.getAttribute('name') === type) {
        item.className += ' checkbox-selected';
      }
    });
  }
  // 生成预览图片
  function previewDesktop() {
    const childElems = Array.from(document.getElementById(`preview-${finalObj.selectType}`).children);
    childElems.forEach((item, index) => {
      item.style.backgroundColor = finalObj[`${finalObj.selectType}Arr`][index].color;
      item.innerHTML = 
        `<div style="display:flex;just-content:center;align-items:center;color:#fff">
          <h1 style="font-weight:bold;font-size:1.6em">${finalObj[`${finalObj.selectType}Arr`][index].text}</h1>
        <div>`
      });
    document.getElementById(`preview-${finalObj.selectType}`).style.display = 'flex';
  }
  // 生成下载图片
  function generateDesktop() {
    const downloadDom = document.getElementById(`download-${finalObj.selectType}`);
    downloadDom.style.width = finalObj.screenWidth / 2 + 'px';
    downloadDom.style.height = finalObj.screenHeight / 2 + 'px';
    const childElems = Array.from(downloadDom.children);
    childElems.forEach((item, index) => {
      item.style.backgroundColor = finalObj[`${finalObj.selectType}Arr`][index].color;
      item.innerHTML = 
        `<div style="display:flex;just-content:center;align-items:center;color:#fff">
          <h1 style="font-weight:bold;font-size:1.6em">${finalObj[`${finalObj.selectType}Arr`][index].text}</h1>
        <div>`
    });
    convert2canvas(downloadDom);
  }
  // 预览的时候点击消失
  Array.from(document.getElementsByClassName('preview')).forEach(item => {
    item.addEventListener('click', function(e) {
      e.target.parentNode.style.display = 'none';
    });
  });
  // 将html转换成canvas
  function convert2canvas(targetDom) {
    const width = parseInt(targetDom.style.width, 10); //获取dom 宽度
    const height = parseInt(targetDom.style.height, 10); //获取dom 高度
    const canvas = document.createElement("canvas"); //创建一个canvas节点
    const scale = window.devicePixelRatio; //定义任意放大倍数 支持小数
    canvas.width = width * scale; //定义canvas 宽度 * 缩放
    canvas.height = height * scale; //定义canvas 高度 *缩放
    canvas.getContext("2d").scale(scale, scale); //获取context,设置scale 
    const opts = {
        scale: scale, // 添加的scale 参数
        canvas: canvas, //自定义 canvas
        width: width, //dom 原始宽度
        height: height,
        useCORS: true // 【重要】开启跨域配置
    };

    html2canvas(targetDom, opts).then(canvas => {
      targetDom.style.display = 'none';
      var context = canvas.getContext('2d');
      // 【重要】关闭抗锯齿
      context.mozImageSmoothingEnabled = false;
      context.webkitImageSmoothingEnabled = false;
      context.msImageSmoothingEnabled = false;
      context.imageSmoothingEnabled = false;
        /* ... your canvas manipulations ... */
      if (canvas.toBlob) {
        canvas.toBlob(
          function (blob) {
            saveAs(blob, 'Effective-Desktop.png');
          },
          'image/png'
        );
      }
    });
  }
</script>
</html>

